"use strict";(self.webpackChunkneomcity_vaibhav=self.webpackChunkneomcity_vaibhav||[]).push([[338],{3776:(e,t,i)=>{i.r(t),i.d(t,{default:()=>b});var s=i(9379),l=i(5043);const a=i.p+"static/media/profilePic.4258a59c0beca9d957b3.png";const n=i.p+"static/media/pencil.d43e603efb86de0b1b95a48f938e3fb4.svg",c=i.p+"static/media/music.d11473e42ae603c35c9d.jpg",r=i.p+"static/media/music.73ae1394695d6d069ebe.png",o=i.p+"static/media/golf.61488efb71411e14b785.png",d=i.p+"static/media/plays.22fc3f780a6ca3989a18.png",u=i.p+"static/media/child.138af7d84d17f42122a1.png",p=i.p+"static/media/social.2ace9f73f35c61a4082a.png",m=i.p+"static/media/exploring.680cf040763839ff3e49.png",g=i.p+"static/media/walking.e55da5b73a286bcbb4c3.png",_=i.p+"static/media/waterSports.ee4769e85105eb9a9302.png";const f=i.p+"static/media/like.d554fda7aee6fd316e1c24ca6d3a43b7.svg";var h=i(579);const k=e=>{let{initialInterests:t=[],onInterestsChange:i}=e;const s=["adventure","golf","child-screaming","walking","water-sports","social","music","explore","rock"],[a,n]=(0,l.useState)(t),[k,v]=(0,l.useState)(""),[x,j]=(0,l.useState)(null),b=(0,l.useRef)(null),y=(0,l.useRef)(null);(0,l.useEffect)((()=>{i&&i(a)}),[a,i]),(0,l.useEffect)((()=>{const e=k.trim().toLowerCase();if(!e)return void j(null);const t=s.find((t=>t.toLowerCase()===e));j(t||null)}),[k,s]);const N=e=>{let t;t=a.includes(e)?a.filter((t=>t!==e)):[...a,e],n(t),b.current&&b.current.focus()},I=e=>a.includes(e)||x===e;return(0,h.jsxs)("div",{className:"selectInterest",children:[(0,h.jsxs)("div",{className:"selectInterest_likes",children:[(0,h.jsxs)("div",{onClick:()=>N("adventure"),className:"selectInterest_likes_input",children:[(0,h.jsx)("p",{children:"adventure"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_img ".concat(I("adventure")?"like_opacity":""),src:d,alt:"adventure"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_thumb ".concat(I("adventure")?"like_active":""),src:f,alt:"like icon"})]}),(0,h.jsxs)("div",{onClick:()=>N("golf"),className:"selectInterest_likes_input",children:[(0,h.jsx)("p",{children:"golf"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_img ".concat(I("golf")?"like_opacity":""),src:o,alt:"golf"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_thumb ".concat(I("golf")?"like_active":""),src:f,alt:"like icon"})]}),(0,h.jsxs)("div",{onClick:()=>N("child-screaming"),className:"selectInterest_likes_input",children:[(0,h.jsx)("p",{children:"child-screaming"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_img ".concat(I("child-screaming")?"like_opacity":""),src:u,alt:"child-screaming"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_thumb ".concat(I("child-screaming")?"like_active":""),src:f,alt:"like icon"})]}),(0,h.jsxs)("div",{onClick:()=>N("walking"),className:"selectInterest_likes_input",children:[(0,h.jsx)("p",{children:"walking"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_img ".concat(I("walking")?"like_opacity":""),src:g,alt:"walking"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_thumb ".concat(I("walking")?"like_active":""),src:f,alt:"like icon"})]}),(0,h.jsxs)("div",{onClick:()=>N("water-sports"),className:"selectInterest_likes_input",children:[(0,h.jsx)("p",{children:"water-sports"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_img ".concat(I("water-sports")?"like_opacity":""),src:_,alt:"water-sports"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_thumb ".concat(I("water-sports")?"like_active":""),src:f,alt:"like icon"})]}),(0,h.jsxs)("div",{onClick:()=>N("social"),className:"selectInterest_likes_input",children:[(0,h.jsx)("p",{children:"social"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_img ".concat(I("social")?"like_opacity":""),src:p,alt:"social"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_thumb ".concat(I("social")?"like_active":""),src:f,alt:"like icon"})]}),(0,h.jsxs)("div",{onClick:()=>N("music"),className:"selectInterest_likes_input",children:[(0,h.jsx)("p",{children:"music"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_img ".concat(I("music")?"like_opacity":""),src:c,alt:"music"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_thumb ".concat(I("music")?"like_active":""),src:f,alt:"like icon"})]}),(0,h.jsxs)("div",{onClick:()=>N("explore"),className:"selectInterest_likes_input",children:[(0,h.jsx)("p",{children:"explore"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_img ".concat(I("explore")?"like_opacity":""),src:m,alt:"explore"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_thumb ".concat(I("explore")?"like_active":""),src:f,alt:"like icon"})]}),(0,h.jsxs)("div",{onClick:()=>N("rock"),className:"selectInterest_likes_input",children:[(0,h.jsx)("p",{children:"rock"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_img ".concat(I("rock")?"like_opacity":""),src:r,alt:"rock"}),(0,h.jsx)("img",{className:"selectInterest_likes_input_thumb ".concat(I("rock")?"like_active":""),src:f,alt:"like icon"})]})]}),(0,h.jsxs)("div",{className:"selectInterest_input_container",children:[(0,h.jsx)("label",{htmlFor:"interest",children:"Please let us know if you have some interests"}),(0,h.jsxs)("div",{className:"selectInterest_input_wrapper",onClick:()=>{b.current&&b.current.focus()},ref:y,children:[(0,h.jsxs)("div",{className:"selectInterest_input_tags",children:[a.map(((e,t)=>(0,h.jsxs)("div",{className:"selectInterest_tag",children:[(0,h.jsx)("span",{className:"selectInterest_tag_text",children:e}),(0,h.jsx)("span",{className:"selectInterest_tag_close",onClick:t=>{t.stopPropagation(),(e=>{const t=a.filter((t=>t!==e));n(t),b.current&&b.current.focus()})(e)},children:"\xd7"})]},t))),(0,h.jsx)("input",{type:"text",id:"interest",ref:b,value:k,onChange:e=>{v(e.target.value)},onKeyDown:e=>{if(","===e.key&&k.trim()){e.preventDefault();const t=k.trim();t&&!a.includes(t)&&(n([...a,t]),v(""),j(null))}if("Backspace"===e.key&&!k&&a.length>0){const e=[...a];e.pop(),n(e)}},className:"selectInterest_input_field",placeholder:a.length?"Type an interest name to highlight it":"Type an interest name to highlight it or add with comma"})]}),k&&(0,h.jsx)("span",{className:"selectInterest_input_clear",onClick:e=>{e.stopPropagation(),v(""),b.current&&b.current.focus()},children:"\xd7"})]})]})]})};var v=i(3449);const x=e=>{if(!e)return"";try{let t;if(e.includes("T"))t=new Date(e);else{if(!e.includes("-"))return"";{const i=e.split("-");t=4===i[0].length?new Date(parseInt(i[0]),parseInt(i[1])-1,parseInt(i[2])):new Date(parseInt(i[2]),parseInt(i[1])-1,parseInt(i[0]))}}if(isNaN(t.getTime()))return"";const i=String(t.getDate()).padStart(2,"0"),s=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear();return"".concat(i,"-").concat(s,"-").concat(l)}catch(t){return console.error("Error formatting date:",t),""}},j=e=>{if(!e)return"";try{if(e.includes("T")){const t=new Date(e);if(isNaN(t.getTime()))return"";const i=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return"".concat(i,"-").concat(s,"-").concat(l)}if(e.includes("-")){const t=e.split("-");return 3!==t.length?"":4===t[0].length?e:"".concat(t[2],"-").concat(t[1],"-").concat(t[0])}return""}catch(t){return console.error("Error formatting date for input:",t),""}},b=()=>{const e=l.useRef(!1),[t,i]=(0,l.useState)(a),[c,r]=(0,l.useState)(),[o,d]=(0,l.useState)(!0),[u,p]=(0,l.useState)(null),[m,g]=(0,l.useState)(!1),_=(0,l.useCallback)((e=>{const{id:t,value:i}=e.target;r((e=>e?(0,s.A)((0,s.A)({},e),{},{[t]:i}):e))}),[]),f=(0,l.useCallback)((e=>{r((t=>t?(0,s.A)((0,s.A)({},t),{},{interests:e}):t))}),[]);async function b(e){try{var t,l;const a=e||(0,s.A)({},c),n=await(0,v.et)("/user/profile",{profileToSend:a});null!==(t=n.profile)&&void 0!==t&&t.dob&&(n.profile.dob=x(n.profile.dob)),r(n.updated_fields),null!==(l=n.updated_fields)&&void 0!==l&&l.profile_img&&i(n.updated_fields.profile_img)}catch(a){console.error("Error updating data:",a)}}const y=(0,l.useCallback)((e=>{e.preventDefault(),c?(t!==a&&r((e=>e?(0,s.A)((0,s.A)({},e),{},{profile_img:t}):e)),alert("Profile updated successfully!"),b()):alert("Profile data not loaded")}),[c,t]),N=(0,l.useCallback)((()=>{window.confirm("Are you sure you want to cancel? Any unsaved changes will be lost.")&&window.history.back()}),[]);(0,l.useEffect)((()=>{!async function(){try{var e;const t=await(0,v.MV)("/user/profile");r(t.profile),null!==(e=t.profile)&&void 0!==e&&e.profile_img&&i(t.profile.profile_img)}catch(t){console.error("Error fetching data:",t)}finally{d(!1)}}()}),[]),(0,l.useEffect)((()=>{null!==c&&void 0!==c&&c.dob&&!e.current&&r((t=>t?(e.current=!0,(0,s.A)((0,s.A)({},t),{},{dob:x(t.dob)})):t))}),[c]);(0,l.useEffect)((()=>{u&&I()}),[u]);const I=async()=>{if(u){g(!0);try{const e=await(async()=>{try{const e=await(0,v.Et)("/user/profile/uploadimg",{profile_img_name:"my_profile"});return e.ok?await e.json():(console.error("Error response from server:",await e.text()),null)}catch(e){return console.error("Error getting presigned URL:",e),null}})();if(!e||!e.uploadUrl)return alert("Error getting presigned URL"),void g(!1);console.log("Attempting to upload to:",e.uploadUrl),console.log("File size:",u.size);const t=await fetch(e.uploadUrl,{method:"PUT",body:u});if(console.log("Upload response status:",t.status),!t.ok){const e=await t.text();throw console.error("Upload error response:",e),new Error("Upload failed: ".concat(t.status," ").concat(t.statusText))}const l=e.publicUrl;if(console.log("Public URL:",l),c){const e=(0,s.A)((0,s.A)({},c),{},{profile_img:l});console.log("Updated profile with new image:",e),i(l),await b(e),r(e),alert("Profile image uploaded successfully!")}else console.error("Profile is undefined, cannot update")}catch(e){console.error("Error uploading profile image:",e),alert("Failed to upload image. Please try again.")}finally{g(!1)}}else console.error("No file selected")};return(0,h.jsx)(h.Fragment,{children:o?(0,h.jsx)("div",{children:"Loading..."}):(0,h.jsx)("div",{className:"editProfile",children:(0,h.jsxs)("div",{className:"editProfilePg",children:[(0,h.jsxs)("h1",{className:"editProfilePg_heading",children:["Edit ",null===c||void 0===c?void 0:c.name,"'s Profile"]}),(0,h.jsxs)("div",{className:"editProfilePg_container",children:[(0,h.jsx)("div",{className:"editProfilePg_container_left",children:(0,h.jsxs)("div",{className:"editProfilePg_container_left_img",children:[(0,h.jsx)("input",{type:"file",accept:"image/*",id:"profileImageInput",style:{display:"none"},onChange:e=>{var t;const s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){p(s);const e=URL.createObjectURL(s);i(e)}}}),(0,h.jsx)("img",{className:"editProfilePg_container_left_img_profileImg",src:(null===c||void 0===c?void 0:c.profile_img)||t,alt:"Profile",style:{opacity:m?.5:1}}),m&&(0,h.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:2},children:"Uploading..."}),(0,h.jsx)("img",{className:"editProfilePg_container_left_img_pencilbtn",src:n,onClick:()=>{var e;m||(null===(e=document.getElementById("profileImageInput"))||void 0===e||e.click())},style:{cursor:m?"not-allowed":"pointer"}})]})}),(0,h.jsxs)("div",{className:"editProfilePg_container_right",children:[(0,h.jsxs)("div",{className:"editProfilePg_container_right_inputs",children:[(0,h.jsx)("label",{htmlFor:"name",children:"What should we call you?"}),(0,h.jsx)("input",{onChange:_,value:(null===c||void 0===c?void 0:c.name)||"",type:"text",id:"name",placeholder:"Vaibhav",required:!0})]}),(0,h.jsxs)("div",{className:"editProfilePg_container_right_inputs",children:[(0,h.jsx)("label",{htmlFor:"email",children:"What's your email address?"}),(0,h.jsx)("input",{onChange:_,value:(null===c||void 0===c?void 0:c.email)||"",type:"email",id:"email",placeholder:"vaibhavemail@gmail.com",required:!0})]}),(0,h.jsxs)("div",{className:"editProfilePg_container_right_inputs",children:[(0,h.jsx)("label",{htmlFor:"mobile_number",children:"On which number can we contact you?"}),(0,h.jsx)("input",{onChange:_,value:(null===c||void 0===c?void 0:c.mobile_number)||"",type:"number",id:"mobile_number",placeholder:"9971 87 7676",required:!0})]}),(0,h.jsxs)("div",{className:"editProfilePg_container_right_inputs",children:[(0,h.jsx)("label",{htmlFor:"dob",children:"When can we wish a happy birthday?"}),(0,h.jsx)("input",{onChange:e=>{const{value:t}=e.target,i=t.split("-");if(3===i.length){const e="".concat(i[2],"-").concat(i[1],"-").concat(i[0]);r((t=>t?(0,s.A)((0,s.A)({},t),{},{dob:e}):t))}},value:j((null===c||void 0===c?void 0:c.dob)||""),type:"date",id:"dob",placeholder:"01-02-2001",required:!0})]}),(0,h.jsx)("div",{className:"editProfilePg_container_right_intputs_interests",children:(0,h.jsx)(k,{initialInterests:(null===c||void 0===c?void 0:c.interests)||[],onInterestsChange:f})}),(0,h.jsxs)("div",{className:"editProfilePg_container_right_btns",children:[(0,h.jsx)("button",{onClick:y,children:"Save"}),(0,h.jsx)("button",{onClick:N,children:"Cancel"})]})]})]})]})})})}}}]);
//# sourceMappingURL=338.0c3cbac2.chunk.js.map